import React from 'react';
import type { PrimeLimit } from '../../../types';

type CommaSpreadingPanelProps = {
    settings: any;
    globalSettings: any;
    allLimits: PrimeLimit[];
    spreadingCollapsed: boolean;
    setSpreadingCollapsed: React.Dispatch<React.SetStateAction<boolean>>;
    handleSettingChange: (...args: any[]) => void;
};

export const CommaSpreadingPanel: React.FC<CommaSpreadingPanelProps> = ({
    settings,
    globalSettings,
    allLimits,
    spreadingCollapsed,
    setSpreadingCollapsed,
    handleSettingChange
}) => { const rawLooping = settings.axisLooping || {}; const gen0Looped = (settings.rootLimits || []).filter((l: PrimeLimit) => rawLooping[l] != null); const gen1Looped = allLimits.filter(l => rawLooping[l] != null && !gen0Looped.includes(l) && settings.gen1Lengths?.[l] !== undefined); const gen2Looped: {
    parent: PrimeLimit;
    child: PrimeLimit;
}[] = []; if (settings.gen2Lengths) {
    Object.keys(settings.gen2Lengths).forEach(parentKey => { const parent = parseInt(parentKey) as PrimeLimit; const children = settings.gen2Lengths![parent]; if (children) {
        Object.keys(children).forEach(childKey => { const child = parseInt(childKey) as PrimeLimit; if (rawLooping[child] != null) {
            gen2Looped.push({ parent, child });
        } });
    } });
} if (gen0Looped.length === 0 && gen1Looped.length === 0 && gen2Looped.length === 0)
    return null; const active = [...gen0Looped, ...gen1Looped, ...gen2Looped.map(g => g.child)].some(l => settings.commaSpreadingEnabled?.[typeof l === 'object' ? l : l]); return (<div className="mt-2 p-2 bg-gray-900 border border-gray-700 rounded">                <div className="flex justify-between items-center">                    <div className="flex items-center gap-2">                        <span className="text-[10px] font-bold text-gray-400 uppercase">Temperament (Comma Spreading)</span>                        {active && <span className="w-1.5 h-1.5 bg-blue-500 rounded-full animate-pulse" title="Active"></span>}                    </div>                    <button onClick={() => setSpreadingCollapsed(!spreadingCollapsed)} className="text-[9px] text-blue-400 hover:text-white">                        {spreadingCollapsed ? 'Show' : 'Hide'}                    </button>                </div>                {!spreadingCollapsed && (<div className="mt-2 space-y-3 animate-in slide-in-from-top-1">                        <p className="text-[9px] text-gray-500 italic">Enable spreading to distribute comma error across loops.</p>                                                {gen0Looped.length > 0 && (<div className="bg-blue-950/20 p-2 rounded border border-blue-900/50">                                <div className="text-[9px] font-bold text-blue-400 uppercase mb-2">Gen 0 (Axis)</div>                                <div className="grid grid-cols-2 gap-2">                                    {gen0Looped.map(l => (<div key={l} className="flex items-center justify-between bg-black/40 px-2 py-1 rounded border border-gray-800">                                            <span className="text-[10px] text-gray-300 font-bold">{l}-Limit</span>                                            <label className="flex items-center gap-2 cursor-pointer">                                                <input type="checkbox" className="w-3 h-3 accent-blue-500" checked={!!settings.commaSpreadingEnabled?.[l]} onChange={(e) => { const current = settings.commaSpreadingEnabled || {}; handleSettingChange('commaSpreadingEnabled', { ...current, [l]: e.target.checked }, true); }}/>                                            </label>                                        </div>))}                                </div>                            </div>)}                                                {gen1Looped.length > 0 && (<div className="bg-green-950/20 p-2 rounded border border-green-900/50">                                <div className="text-[9px] font-bold text-green-400 uppercase mb-2">Gen 1 (Branches)</div>                                <div className="grid grid-cols-2 gap-2">                                    {gen1Looped.map(l => (<div key={l} className="flex items-center justify-between bg-black/40 px-2 py-1 rounded border border-gray-800">                                            <span className="text-[10px] text-gray-300 font-bold">{l}-Limit</span>                                            <label className="flex items-center gap-2 cursor-pointer">                                                <input type="checkbox" className="w-3 h-3 accent-green-500" checked={!!settings.commaSpreadingEnabled?.[l]} onChange={(e) => { const current = settings.commaSpreadingEnabled || {}; handleSettingChange('commaSpreadingEnabled', { ...current, [l]: e.target.checked }, true); }}/>                                            </label>                                        </div>))}                                </div>                            </div>)}                                                {gen2Looped.length > 0 && (<div className="bg-yellow-950/20 p-2 rounded border border-yellow-900/50">                                <div className="text-[9px] font-bold text-yellow-400 uppercase mb-2">Gen 2 (Sub-Branches)</div>                                <div className="grid grid-cols-2 gap-2">                                    {gen2Looped.map(({ parent, child }, idx) => (<div key={`${parent}-${child}-${idx}`} className="flex items-center justify-between bg-black/40 px-2 py-1 rounded border border-gray-800">                                            <span className="text-[10px] text-gray-300 font-bold">{child}-L (on {parent})</span>                                            <label className="flex items-center gap-2 cursor-pointer">                                                <input type="checkbox" className="w-3 h-3 accent-yellow-500" checked={!!settings.commaSpreadingEnabled?.[child]} onChange={(e) => { const current = settings.commaSpreadingEnabled || {}; handleSettingChange('commaSpreadingEnabled', { ...current, [child]: e.target.checked }, true); }}/>                                            </label>                                        </div>))}                                </div>                            </div>)}                    </div>)}            </div>); };
